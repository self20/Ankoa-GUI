#:kivy 1.8.0
#:import user app.settings.conf_dict.user
#:import filter app.settings.conf_dict.filter

# ---------- FILEMANAGER ----------
<ManagerPopup>:
    size_hint: .8, .8
    auto_dismiss: True
    title: 'File Manager'

    BoxLayout:
        TabbedPanel:
            tab_pos: "top_right"
            default_tab_text: "List View"
            default_tab_content: list_view_tab

            TabbedPanelHeader:
                text: 'Icon View'
                content: icon_view_tab

            # --- LIST VIEW ---
            FileChooserListView:
                id: list_view_tab
                filters:
                    filter['audio_filter'] if\
                    filter['request'] == 'audio_source' else\
                    filter['sub_filter'] if\
                    filter['request'] == 'sub_source' else\
                    filter['encode_filter'] if\
                    filter['request'] == 'encode_source' else\
                    filter['remux_filter'] if\
                    filter['request'] == 'remux_source' else\
                    filter['extract_filter'] if\
                    filter['request'] == 'extract_source' else ''
                rootpath: user['source_folder']
                value:
                    self.selection and\
                    self.selection[0] or ''
                on_selection:
                    app.load_sub_source(self.value) if\
                    filter['request'] == 'sub_source' else\
                    app.scan_source_infos(
                    self.selection and self.selection[0]);\
                    app.load_video_source(
                    self.selection and self.selection[0]) if\
                    filter['request'] == 'encode_source' or\
                    filter['request'] == 'remux_source' or\
                    filter['request'] == 'extract_source' else ''

            # --- ICON VIEW ---
            FileChooserIconView:
                id: icon_view_tab
                filters:
                    filter['audio_filter'] if\
                    filter['request'] == 'audio_source' else\
                    filter['sub_filter'] if\
                    filter['request'] == 'sub_source' else\
                    filter['encode_filter'] if\
                    filter['request'] == 'encode_source' else\
                    filter['remux_filter'] if\
                    filter['request'] == 'remux_source' else\
                    filter['extract_filter'] if\
                    filter['request'] == 'extract_source' else ''
                rootpath: usfilterer['source_folder']
                value:
                    self.selection and\
                    self.selection[0] or ''
                on_selection:
                    app.load_sub_source(self.value) if\
                    filter['request'] == 'sub_source' else\
                    app.scan_source_infos(
                    self.selection and self.selection[0]);\
                    app.load_video_source(
                    self.selection and self.selection[0]) if\
                    filter['request'] == 'encode_source' or\
                    filter['request'] == 'remux_source' or\
                    filter['request'] == 'extract_source' else ''
