#:kivy 1.8.0
#:import fixed_size app.mod_encode.encode_var.fixed_size
#:import audio_bitrate app.mod_encode.encode_var.audio_bitrate
#:import x264_preset app.mod_encode.encode_var.preset
#:import x264_tune app.mod_encode.encode_var.tune
#:import x264_profile app.mod_encode.encode_var.profile
#:import x264_level app.mod_encode.encode_var.level
#:import x264_framerate app.mod_encode.encode_var.framerate

# ---------- VIDEO SCREEN ----------
<videox@Widget>:
    pos_hint: {'center_x': .5, 'center_y': .5}
    size_hint: .96, .96
    cols: 1

    # ---------- SOURCE INFOS ----------
    BoxLayout:
        size_hint: 1, .4
        TextInput:
            readonly: True
            padding_x: '20sp'
            cursor_color: 0, 0, 0, .5
            background_color: 0, 0, 0, .5
            foreground_color: 0, 255, 0, 1
            hint_text: 'Source Infos Area'
            hint_text_color: 0, 255, 0, 1
            text:
                '' if app.scan_data is None else\
                (app.scan_data).strip()

    # ---------- VIDEO CODEC / CONTAINER ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, .5
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Container ---
        Switch:
            id: check_codec
            size_hint_x: .20
            touch_control: False
            active:
                True if (root.ids.matroska.state == 'down' or
                root.ids.mp4.state == 'down') and\
                (root.ids.x264.state == 'down' or
                root.ids.x265.state == 'down') else False

        # --- Container Label ---
        Label:
            text: 'Container'
            bold: True
            size_hint_x: .40

        BoxLayout:
            id: vcontainer
            valueA: ''
            valueB: ''

            # --- MKV button ---
            ToggleButton:
                id: matroska
                text: 'MATROSKA'
                group: 'v_container'
                on_release: root.ids.vcontainer.valueA = 'mastroska'

            # --- MP4 button ---
            ToggleButton:
                id: mp4
                text: 'MPEG-4'
                group: 'v_container'
                on_release: root.ids.vcontainer.valueA = 'mp4'

            # --- x264 button ---
            ToggleButton:
                id: x264
                text: 'x264'
                group: 'v_codec'
                on_release: root.ids.vcontainer.valueB = 'libx264'

            # --- x265 button ---
            ToggleButton:
                id: x265
                text: 'x265'
                group: 'v_codec'
                on_release: root.ids.vcontainer.valueB = 'libx265'

    # ---------- 2PASS MODE ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, 1
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check 2PASS ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active:
                False if root.ids.video_bitrate.text == '' else True

        # --- 2PASS Label ---
        Label:
            text: '2PASS Mode'
            bold: True
            size_hint_x: .40

        BoxLayout:

            # --- Video Bitrate ---
            Label:
                text: 'Video Kbps'
            TextInput:
                id: video_bitrate
                multiline: False
                input_filter: 'int'
                text: app.current_bitrate
            Label:

            # --- Bitrate Calculator button ---
            ToggleButton:
                text: 'Bitrate Calculator'
                on_press: app.toggle_bitrate(self.state)

    # ---------- BITRATE CALCULATOR ----------
    ScrollView:
        id: bitrate_view
        size_hint_y: None
        height: 0
        BoxLayout:
            padding: '8sp'
            canvas:
                Color:
                    rgba: 0, 0, 0, 1
                Rectangle:
                    size: self.size
                    pos: self.pos

            # --- HOURS ---
            TextInput:
                id: HH
                hint_text: 'HH'
                size_hint: .6, 1
                multiline: False
                input_filter: 'int'

            # --- MINUTES ---
            TextInput:
                id: MM
                hint_text: 'MM'
                size_hint: .6, 1
                multiline: False
                input_filter: 'int'

            # --- SECONDS ---
            TextInput:
                id: SS
                hint_text: 'SS'
                size_hint: .6, 1
                multiline: False
                input_filter: 'int'
            Label:

            # --- Audio Bitrate ---
            Label:
                text: 'Audio'
            Slider:
                size_hint: 3, 1
                id: audio_bit
                min: 0
                max: 9
                step: 1
                value: 6
            Label:
                text:
                    audio_bitrate[int('{}'.format(audio_bit.value)
                    .split('.')[0])]
                bold: True
            Label:

            # --- Desired Size ---
            Label:
                text: 'Size'
            Slider:
                size_hint: 3, 1
                id: desired_size
                min: 0
                max: 7
                step: 1
                value: 3
            Label:
                text:
                    fixed_size[int('{}'.format(desired_size.value)
                    .split('.')[0])]
                bold: True
            Label:

            # --- Run Calculator ---
            Button:
                text: 'RUN'
                on_press:
                    app.bit_calculator(
                    root.ids.HH.text, root.ids.MM.text,
                    root.ids.SS.text, root.ids.audio_bit.value,
                    root.ids.desired_size.value)\
                    if root.ids.HH.text and root.ids.MM.text\
                    and root.ids.SS.text else ''

    # ---------- CRF MODE ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, .5
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check CRF ---
        Switch:
            id: check_crf
            size_hint_x: .20
            touch_control: False
            active:
                True if root.ids.video_bitrate.text == '' else False

        # --- CRF Label ---
        Label:
            text: 'CRF Level'
            bold: True
            size_hint_x: .40

        # --- CRF Value ---
        BoxLayout:
            Slider:
                id: crf
                min: 0
                max: 51
                step: 1
                value: 0
            Label:
                text: '{}'.format(crf.value).split('.')[0]
                bold: True

    # ---------- FRAMERATE ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, 1
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Framerate ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active: True

        # --- Framerate Label ---
        Label:
            text: 'Framerate'
            bold: True
            size_hint_x: .40

        # --- Framerate Value ---
        BoxLayout:
            Slider:
                id: framerate
                min: 0
                max: 11
                step: 1
                value: 4
            Label:
                id: fram_rate
                text:
                    x264_framerate[int('{}'.format(framerate.value)
                    .split('.')[0])]
                bold: True

    # ---------- PRESET ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, .5
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Preset ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active:
                True if root.ids.preset.value != 0 else False

        # --- Preset Label ---
        Label:
            text: 'Preset'
            bold: True
            size_hint_x: .40

        # --- Preset Value ---
        BoxLayout:
            Slider:
                id: preset
                min: 0
                max: 9
                step: 1
                value: 0
            Label:
                id: pre_set
                text:
                    x264_preset[int('{}'.format(preset.value)
                    .split('.')[0])]
                bold: True

    # ---------- TUNE ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, 1
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Tune ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active:
                True if root.ids.tune.value != 0 else False

        # --- Tune Label ---
        Label:
            text: 'Tune'
            bold: True
            size_hint_x: .40

        # --- Check Value ---
        BoxLayout:
            Slider:
                id: tune
                min: 0
                max: 7
                step: 1
                value: 0
            Label:
                id: tu_ne
                text:
                    x264_tune[int('{}'.format(tune.value)
                    .split('.')[0])]
                bold: True

    # ---------- PROFILE ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, .5
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Profile ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active:
                True if root.ids.profile.value != 0 else False

        # --- Profile Label ---
        Label:
            text: 'Profile'
            bold: True
            size_hint_x: .40

        # --- Profile Value ---
        BoxLayout:
            Slider:
                id: profile
                min: 0
                max: 3
                step: 1
                value: 0
            Label:
                id: pro_file
                text:
                    x264_profile[int('{}'.format(profile.value)
                    .split('.')[0])]
                bold: True

    # ---------- LEVEL ----------
    BoxLayout:
        padding: '8sp'
        orientation: 'horizontal'
        size_hint: 1, .1
        canvas:
            Color:
                rgba: .2, .3, .4, 1
            Rectangle:
                size: self.size
                pos: self.pos

        # --- Check Level ---
        Switch:
            size_hint_x: .20
            touch_control: False
            active: True

        # --- Level Label ---
        Label:
            text: 'Level'
            bold: True
            size_hint_x: .40

        # --- Level Value ---
        BoxLayout:
            Slider:
                id: level
                min: 0
                max: 15
                step: 1
                value: 8
            Label:
                id: le_vel
                text:
                    x264_level[int('{}'.format(level.value)
                    .split('.')[0])]
                bold: True
